<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MyMusic.Native.MainPage"
             BackgroundColor="#15151e"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto,Auto,*,Auto" Padding="20">

        <!-- ═══ Header ═══ -->
        <Grid Grid.Row="0" ColumnDefinitions="Auto,*" Padding="4,8,4,16">
            <HorizontalStackLayout Grid.Column="0" Spacing="10" VerticalOptions="Center">
                <Label Text="&#9835;" FontSize="28" TextColor="#7c3aed" VerticalOptions="Center" />
                <Label Text="myMusic" FontSize="26" FontAttributes="Bold" TextColor="#e2e8f0"
                       VerticalOptions="Center" />
            </HorizontalStackLayout>
            <Label Grid.Column="1" Text="Piano Sight-Reading" FontSize="13" TextColor="#64748b"
                   VerticalOptions="Center" HorizontalOptions="End" Padding="0,0,8,0" />
        </Grid>

        <!-- ═══ Controls Card ═══ -->
        <Border Grid.Row="1"
                Stroke="#2d2d44"
                StrokeThickness="1"
                StrokeShape="RoundRectangle 12"
                BackgroundColor="#1e1e2e"
                Padding="16,12,16,8"
                Margin="0,0,0,12">
            <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="10">

                <!-- Row 1: Pickers -->
                <FlexLayout Grid.Row="0" Wrap="Wrap" AlignItems="End" JustifyContent="Start">

                    <VerticalStackLayout Margin="0,0,16,6">
                        <Label Text="KEY" FontSize="10" TextColor="#7c3aed" FontAttributes="Bold"
                               Margin="2,0,0,2" CharacterSpacing="1" />
                        <Border Stroke="#334155" StrokeThickness="1" StrokeShape="RoundRectangle 8"
                                BackgroundColor="#262640" Padding="4,0" HeightRequest="38">
                            <Picker x:Name="KeyPicker" WidthRequest="170" TextColor="#e2e8f0"
                                    FontSize="13" SelectedIndexChanged="OnPickerChanged" />
                        </Border>
                    </VerticalStackLayout>

                    <VerticalStackLayout Margin="0,0,16,6">
                        <Label Text="DIFFICULTY" FontSize="10" TextColor="#7c3aed" FontAttributes="Bold"
                               Margin="2,0,0,2" CharacterSpacing="1" />
                        <Border Stroke="#334155" StrokeThickness="1" StrokeShape="RoundRectangle 8"
                                BackgroundColor="#262640" Padding="4,0" HeightRequest="38">
                            <Picker x:Name="DifficultyPicker" WidthRequest="130" TextColor="#e2e8f0"
                                    FontSize="13" SelectedIndexChanged="OnPickerChanged" />
                        </Border>
                    </VerticalStackLayout>

                    <VerticalStackLayout Margin="0,0,16,6">
                        <Label Text="TIME" FontSize="10" TextColor="#7c3aed" FontAttributes="Bold"
                               Margin="2,0,0,2" CharacterSpacing="1" />
                        <Border Stroke="#334155" StrokeThickness="1" StrokeShape="RoundRectangle 8"
                                BackgroundColor="#262640" Padding="4,0" HeightRequest="38">
                            <Picker x:Name="TimeSigPicker" WidthRequest="75" TextColor="#e2e8f0"
                                    FontSize="13" SelectedIndexChanged="OnPickerChanged" />
                        </Border>
                    </VerticalStackLayout>

                    <VerticalStackLayout Margin="0,0,16,6">
                        <Label Text="BARS" FontSize="10" TextColor="#7c3aed" FontAttributes="Bold"
                               Margin="2,0,0,2" CharacterSpacing="1" />
                        <Border Stroke="#334155" StrokeThickness="1" StrokeShape="RoundRectangle 8"
                                BackgroundColor="#262640" Padding="4,0" HeightRequest="38">
                            <Picker x:Name="MeasuresPicker" WidthRequest="65" TextColor="#e2e8f0"
                                    FontSize="13" SelectedIndexChanged="OnPickerChanged" />
                        </Border>
                    </VerticalStackLayout>
                </FlexLayout>

                <!-- Row 2: BPM + Buttons -->
                <FlexLayout Grid.Row="1" Wrap="Wrap" AlignItems="End" JustifyContent="Start">

                    <VerticalStackLayout Margin="0,0,20,6" WidthRequest="200">
                        <Label x:Name="BpmLabel" Text="BPM  90" FontSize="10" TextColor="#7c3aed"
                               FontAttributes="Bold" Margin="2,0,0,2" CharacterSpacing="1" />
                        <Slider x:Name="BpmSlider" Minimum="40" Maximum="200" Value="90"
                                MinimumTrackColor="#7c3aed" MaximumTrackColor="#334155"
                                ThumbColor="#9061f9" ValueChanged="OnBpmChanged" />
                    </VerticalStackLayout>

                    <Button x:Name="GenerateBtn" Text="Generate"
                            BackgroundColor="#7c3aed" TextColor="White"
                            FontAttributes="Bold" FontSize="14"
                            CornerRadius="10" HeightRequest="40"
                            Padding="24,0" Margin="0,0,10,6"
                            Clicked="OnGenerateClicked" />

                    <Button x:Name="PlayStopBtn" Text="Play"
                            BackgroundColor="#10b981" TextColor="White"
                            FontAttributes="Bold" FontSize="14"
                            CornerRadius="10" HeightRequest="40"
                            Padding="24,0" Margin="0,0,0,6"
                            IsEnabled="False"
                            Clicked="OnPlayStopClicked" />
                </FlexLayout>

                <!-- Row 3: Progression info -->
                <Label x:Name="ProgressionLabel" Grid.Row="2"
                       Text="" FontSize="11" TextColor="#64748b" Margin="2,0,0,0" />
            </Grid>
        </Border>

        <!-- ═══ Notation Area ═══ -->
        <Border Grid.Row="2"
                Stroke="#3d3456"
                StrokeThickness="1.5"
                StrokeShape="RoundRectangle 12"
                Padding="0"
                BackgroundColor="#fefcf3">
            <GraphicsView x:Name="NotationView" BackgroundColor="#fefcf3" />
        </Border>

        <!-- ═══ Status Bar ═══ -->
        <Grid Grid.Row="3" ColumnDefinitions="Auto,*" Padding="4,10,4,2">
            <Border Grid.Column="0" StrokeThickness="0" BackgroundColor="#1a1a2a"
                    StrokeShape="RoundRectangle 4" Padding="8,3" IsVisible="{Binding Source={x:Reference StatusIndicator}, Path=IsVisible}">
                <Label x:Name="StatusIndicator" Text="&#9679;" FontSize="9" TextColor="#10b981" IsVisible="False" />
            </Border>
            <Label x:Name="StatusLabel" Grid.Column="1"
                   Text="Ready" FontSize="11" TextColor="#64748b"
                   VerticalOptions="Center" Padding="8,0,0,0" />
        </Grid>
    </Grid>

</ContentPage>
