<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>PianoSight — Esercizi di Lettura Musicale</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="app-header">
    <div class="logo">
      <svg class="logo-icon" viewBox="0 0 40 40" width="40" height="40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <rect x="2" y="8" width="36" height="24" rx="3" fill="#1a1a1a"/>
        <rect x="5"  y="8" width="5" height="15" rx="1" fill="#fff"/>
        <rect x="11" y="8" width="5" height="15" rx="1" fill="#fff"/>
        <rect x="17" y="8" width="5" height="15" rx="1" fill="#fff"/>
        <rect x="23" y="8" width="5" height="15" rx="1" fill="#fff"/>
        <rect x="29" y="8" width="5" height="15" rx="1" fill="#fff"/>
        <rect x="8"  y="8" width="3" height="10" rx="0.5" fill="#1a1a1a"/>
        <rect x="14" y="8" width="3" height="10" rx="0.5" fill="#1a1a1a"/>
        <rect x="22" y="8" width="3" height="10" rx="0.5" fill="#1a1a1a"/>
        <rect x="28" y="8" width="3" height="10" rx="0.5" fill="#1a1a1a"/>
        <circle cx="20" cy="28" r="2.5" fill="#2d5dd4"/>
      </svg>
      <h1>Piano<span class="logo-accent">Sight</span></h1>
    </div>
    <p class="subtitle">Esercizi casuali di lettura a prima vista</p>
    <button id="help-btn" class="icon-btn help-btn" title="Guida">?</button>
  </header>

  <main class="container">
    <div class="card notation-card">
      <div id="notation"></div>
      <div id="audio-status"></div>
    </div>

    <div class="card controls">
      <div class="controls-grid">
        <div class="control-group">
          <label for="key">Tonalita</label>
          <select id="key">
            <optgroup label="Maggiore">
              <option value="C" selected>Do (C)</option>
              <option value="G">Sol (G)</option>
              <option value="D">Re (D)</option>
              <option value="A">La (A)</option>
              <option value="E">Mi (E)</option>
              <option value="B">Si (B)</option>
              <option value="F">Fa (F)</option>
              <option value="Bb">Sib (Bb)</option>
              <option value="Eb">Mib (Eb)</option>
              <option value="Ab">Lab (Ab)</option>
            </optgroup>
            <optgroup label="Minore">
              <option value="Am">Lam (Am)</option>
              <option value="Em">Mim (Em)</option>
              <option value="Bm">Sim (Bm)</option>
              <option value="F#m">Fa#m (F#m)</option>
              <option value="Dm">Rem (Dm)</option>
              <option value="Gm">Solm (Gm)</option>
              <option value="Cm">Dom (Cm)</option>
              <option value="Fm">Fam (Fm)</option>
            </optgroup>
            <optgroup label="Dorico">
              <option value="D dor">Re Dorico (D dor)</option>
              <option value="G dor">Sol Dorico (G dor)</option>
              <option value="A dor">La Dorico (A dor)</option>
              <option value="C dor">Do Dorico (C dor)</option>
            </optgroup>
            <optgroup label="Misolidio">
              <option value="G mix">Sol Misolidio (G mix)</option>
              <option value="C mix">Do Misolidio (C mix)</option>
              <option value="D mix">Re Misolidio (D mix)</option>
              <option value="F mix">Fa Misolidio (F mix)</option>
            </optgroup>
            <optgroup label="Lidio">
              <option value="F lyd">Fa Lidio (F lyd)</option>
              <option value="C lyd">Do Lidio (C lyd)</option>
              <option value="G lyd">Sol Lidio (G lyd)</option>
              <option value="Bb lyd">Sib Lidio (Bb lyd)</option>
            </optgroup>
            <optgroup label="Frigio">
              <option value="E phr">Mi Frigio (E phr)</option>
              <option value="A phr">La Frigio (A phr)</option>
              <option value="B phr">Si Frigio (B phr)</option>
              <option value="D phr">Re Frigio (D phr)</option>
            </optgroup>
          </select>
        </div>

        <div class="control-group">
          <label for="difficulty">Difficolta</label>
          <select id="difficulty">
            <option value="starter">Iniziale</option>
            <option value="beginner">Principiante</option>
            <option value="intermediate" selected>Intermedio</option>
            <option value="advanced">Avanzato</option>
          </select>
        </div>

        <div class="control-group">
          <label for="timesig">Tempo</label>
          <select id="timesig">
            <option value="4/4" selected>4/4</option>
            <option value="3/4">3/4</option>
            <option value="2/4">2/4</option>
          </select>
        </div>

        <div class="control-group">
          <label for="measures">Battute</label>
          <select id="measures">
            <option value="4" selected>4</option>
            <option value="6">6</option>
            <option value="8">8</option>
          </select>
        </div>

        <div class="control-group">
          <label for="bpm">BPM: <span id="bpm-value">90</span></label>
          <input type="range" id="bpm" min="60" max="140" value="90">
        </div>
      </div>

      <div class="controls-actions">
        <button id="generate-btn">Genera</button>
        <button id="random-btn">Random</button>
        <button id="random-settings-btn" class="icon-btn" title="Impostazioni Random">&#9881;</button>
        <button id="play-btn" disabled>Play</button>
        <button id="pdf-btn" class="icon-btn" title="Scarica PDF" disabled>&#8681;</button>
      </div>
    </div>

    <div id="random-modal" class="modal-overlay hidden">
      <div class="modal">
        <div class="modal-header">
          <span>Impostazioni Random</span>
          <button id="random-modal-close" class="modal-close-btn">&times;</button>
        </div>
        <div id="random-modal-body" class="modal-body"></div>
        <div class="modal-footer">
          <small>Per Intermedio e Avanzato il pool viene espanso automaticamente.</small>
          <button id="random-reset-btn">Ripristina default</button>
        </div>
      </div>
    </div>
    <div id="help-modal" class="modal-overlay hidden">
      <div class="modal">
        <div class="modal-header">
          <span>Guida</span>
          <button id="help-modal-close" class="modal-close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="help-item">
            <div class="help-item-title">&#9835; Cos'e PianoSight</div>
            <div class="help-item-desc">Genera spartiti casuali per esercitarti nella lettura a prima vista al pianoforte.</div>
          </div>
          <div class="help-item">
            <div class="help-item-title">&#9654; Genera</div>
            <div class="help-item-desc">Crea uno spartito con le impostazioni che hai scelto manualmente (tonalita, difficolta, tempo, battute).</div>
          </div>
          <div class="help-item">
            <div class="help-item-title">&#127922; Random</div>
            <div class="help-item-desc">Sceglie casualmente dal pool configurabile di tonalita, tempi e battute, poi genera lo spartito.</div>
          </div>
          <div class="help-item">
            <div class="help-item-title">&#9881; Ingranaggio</div>
            <div class="help-item-desc">Apre la configurazione del pool Random: scegli quali tonalita, tempi e battute includere nell'estrazione casuale.</div>
          </div>
          <div class="help-item">
            <div class="help-item-title">&#9205; Play / Stop</div>
            <div class="help-item-desc">Riproduce o ferma l'audio dello spartito generato, alla velocita indicata dal BPM.</div>
          </div>
          <div class="help-item">
            <div class="help-item-title">&#8681; PDF</div>
            <div class="help-item-desc">Scarica lo spartito corrente in formato PDF.</div>
          </div>
          <div class="help-item">
            <div class="help-item-title">&#9881; Controlli</div>
            <div class="help-item-desc"><strong>Tonalita</strong> — scala e armatura di chiave.
              <strong>Difficolta</strong> — Principiante (note semplici, posizione fissa), Intermedio (ritmi vari, salti moderati), Avanzato (figurazioni complesse, ampio raggio).
              <strong>Tempo</strong> — 4/4, 3/4 o 2/4.
              <strong>Battute</strong> — lunghezza dello spartito.
              <strong>BPM</strong> — velocita di riproduzione audio.</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script defer src="https://cdn.jsdelivr.net/npm/abcjs@6.6.1/dist/abcjs-basic-min.js"
    integrity="sha384-2rtDDe3cIcOADRWNtfy/FINbyt41hbeK20ml+Uo/wRxjN2wHB4sI1xHC7hV9dHTc"
    crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.2/dist/jspdf.umd.min.js"
    integrity="sha384-en/ztfPSRkGfME4KIm05joYXynqzUgbsG5nMrj/xEFAHXkeZfO3yMK8QQ+mP7p1/"
    crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/svg2pdf.js@2.3.0/dist/svg2pdf.umd.min.js"
    integrity="sha384-sRb188NXE8ku8ZbRRZ1zljRWe+ze/QW/jKHA8UembL/MxZQEDjtv0C2jbKzEzjj1"
    crossorigin="anonymous"></script>
  <script defer src="js/generator.js"></script>
  <script defer src="js/renderer.js"></script>
  <script defer src="js/player.js"></script>
  <script defer src="js/pdf.js"></script>
  <script defer src="js/main.js"></script>
</body>
</html>
